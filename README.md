
# Musical Harmony Analysis â€“ README

This project performs MIR-based (Music Information Retrieval) analysis of audio tracks (MP3, M4A/ALAC, FLAC, WAVâ€¦) without relying on any machineâ€‘learning datasets or Spotify Premium.  
Focused on DJâ€‘relevant signal features: rhythmic density, percussive character, tonal center, spectral balance, and transient sharpness.
Capability to load playlists in csv format (prepared for those generated by Engine DJ)

## ðŸŽ¯ **Two Analysis Workflows**

### **1. Folder-Based Analysis** (`analyse_music.py`)
- Scans `music/` folder recursively
- Analyzes all audio files found
- Output: `analysis.csv`

### **2. Playlist-Based Analysis** (`analyse_from_playlist.py`)
- **Interactive CSV selection** from available playlist exports
- **Track range selection** (e.g., tracks 11-20)
- Uses file paths from playlist CSV (no `music/` folder needed)
- Preserves playlist metadata: `#`, `Title`, `Artist`, `Album`
- Output: `analysis_[playlist]_tracks_[start]-[end].csv`
- **Ideal for analyzing DJ sets in playlist order**

## ðŸ“Š **Visualization Tools**

### **`plot_analysis.py`**
- Visualizes `analysis.csv` (folder-based analysis)
- Multi-panel bar charts for all MIR features

### **`plot_from_playlist.py`**
- **Interactive visualization** for playlist-based analysis (build for Engine DJ CSV exports)
- **Sorted by playlist order** (track #)
- **Category headers**: Energy Profile, Rhythmic Intensity, Spectral Balance
- **Key display**: Color-coded by mode (ðŸŸ¢ Major / ðŸ”´ Minor)
- **Single-row layout** with track labels shown once
- Output: `[input_filename]_plot.png`

---

## ðŸŽµ **Analyzed Audio Parameters (Explained Technically)**

Below are all lowâ€‘complexity, fully deterministic DSP metrics extracted from audio in this project.  
Each metric is based on established MIR methods (Essentia, Librosa) and corresponds to DJâ€‘relevant perceptual qualities.

---

## **1. Key (TÃ³nina) & Mode (Major/Minor)**  
**Method:** Essentia `KeyExtractor`  
- Detects global tonal center (e.g., F#, D, Aâ™­).  
- Major/minor classification.  
- `key_strength` indicates model confidence.

**Usage for DJs:** harmonic mixing, Camelot mapping, color-coded grouping.

---

## **2. BPM (Tempo)**  
**Method:** Essentia `RhythmExtractor2013`  
- Robust beat detection using multi-feature estimation.  
- `bpm_confidence` for reliability.

**Usage:** verifying tempo, detecting problematic files (rips, edits).

**Note:** BPM is computed but **not displayed in playlist visualizations** since DJs typically adjust tempo manually (not informative for mix planning).

---

## **3. RMS Energy**  
**What it represents:** raw physical energy of the waveform.

**Why it matters:** correlates with perceived punch, but does not equal loudness.  
Useful as a neutral, gainâ€‘independent baseline.

**Visualization:**
- **RMS Energy** (`rms_mean`) â€“ average energy level
- **Energy Variation** (`rms_std`) â€“ dynamic range / energy fluctuation

Parameters:
- `rms_mean`  
- `rms_std`

---

## **4. Percussive Ratio (HPSS)**  
**Method:** Harmonicâ€“Percussive Source Separation  
Measures how much of the signal consists of *transients / drum hits* vs *pads / harmonic content*.

- High â†’ techno, electro, energetic bangers  
- Low â†’ deep house, ambient, grooveâ€‘light tracks

**One of the best simple predictors of "energy feel"** â€“ distinguishes percussion-driven vs pad-driven tracks.

**Visualization:** Displayed under **"Energy Profile"** category alongside RMS Energy.

Parameter:
- `percussive_ratio`

---

## **5. Onset Rate (Rhythmic Density)**  
**Meaning:** counts how many transient events per second occur.

This reliably captures:
- **1/8 hats** (high onset density â†’ energetic feel)  
- **1/4 hats** (lower density â†’ drop in groove)

**Most important indicator of groove intensity** â€“ directly corresponds to perceived rhythmic activity.

**Visualization:** Displayed under **"Rhythmic Intensity"** category alongside Attack Sharpness.

Parameter:
- `onset_rate` (events per second)

---

## **6. Spectral Centroid (Brightness)**  
**Meaning:** where the "center of mass" of spectral energy lies.  
- High values â†’ crisp, hi-hat heavy, sizzle
- Low values â†’ warm, dark, deep

**Visualization:**
- **Brightness** (`centroid_mean`) â€“ average timbral brightness
- Not displayed: `centroid_std` (timbral variation over time)

Parameters:
- `centroid_mean` (Hz)  
- `centroid_std` (Hz)

---

## **7. Spectral Flux (Spectral Dynamics)**  
**Meaning:** how much the spectrum changes frameâ€‘toâ€‘frame.  
Tracks with strong percussion and rhythmic movement have high flux.

**Correlates with:** rhythmic heartbeat, spectral activity, dynamic changes

**Visualization:** Displayed as **"Spectral Flux"**

Parameters:
- `flux_mean`
- `flux_std`

---

## **8. High-Frequency Ratio (â‰¥ 6 kHz)**  
A proxy for the **hi-hat / shimmer layer**.

- High â†’ crisp top end, energetic hats  
- Low â†’ muffled, soft, padâ€‘driven

**Visualization:** Displayed under **"Spectral Balance"** category as **"HF Ratio (â‰¥6kHz)"**

Parameter:
- `hf_ratio`

---

## **9. Bass Ratio (< 200 Hz)**  
Measures lowâ€‘end dominance.

- High â†’ sub-heavy, bass-driven tracks
- Low â†’ mid/high-focused, lighter bass presence
- Useful to identify tracks with strong sub/bass  
- Helps characterize balance (subâ€‘heavy vs midâ€‘heavy tracks)

**Visualization:** Displayed under **"Spectral Balance"** category as **"Bass Ratio (<200Hz)"**

Parameter:
- `bass_ratio`

---

## **10. Attack Sharpness**  
Derived from the slope of the onset envelope.  
Captures how "hard" the transient attacks are.

- High â†’ electro/techno punchy kicks, sharp transients
- Low â†’ deep house smooth edges, soft attacks

**One of the best indicators of track character** â€“ distinguishes aggressive vs smooth production styles.

**Visualization:** Displayed under **"Rhythmic Intensity"** category alongside Onset Rate.

Parameter:
- `attack_sharpness`

---

# ðŸ“ˆ Output Format  

## **Folder-Based Analysis**
```
analysis.csv
```
Each row = one track, columns = features (filename, key, mode, bpm, all MIR metrics)

## **Playlist-Based Analysis**
```
analysis_[playlist_name]_tracks_[start]-[end].csv
```
Each row = one track with:
- Playlist metadata: `#`, `Title`, `Artist`, `Album`
- All MIR features (key, mode, bpm, rms_mean, etc.)

---

# ðŸ“‚ Directory Structure

```
MusicalHarmonyAnalysis/
 â”œâ”€â”€ music/                    # audio files for folder-based analysis
 â”œâ”€â”€ analyse_music.py          # folder-based analyzer
 â”œâ”€â”€ analyse_from_playlist.py  # playlist-based analyzer (interactive)
 â”œâ”€â”€ plot_analysis.py          # visualize folder analysis
 â”œâ”€â”€ plot_from_playlist.py     # visualize playlist analysis (interactive)
 â”œâ”€â”€ analysis.csv              # folder analysis output
 â”œâ”€â”€ analysis_*.csv            # playlist analysis outputs
 â”œâ”€â”€ *_plot.png                # visualization outputs
 â”œâ”€â”€ .venv/                    # uv virtual environment
 â””â”€â”€ run.sh                    # bootstrap / execution
```

---

# ðŸŽ¨ Visualization Features

## **Category-Based Grouping**
Plots organize metrics into logical categories:

### **Energy Profile** (Orange Header)
- RMS Energy
- Percussive Ratio

### **Rhythmic Intensity** (Green Header)
- Onset Rate
- Attack Sharpness

### **Spectral Balance** (Blue Header)
- HF Ratio (â‰¥6kHz)
- Bass Ratio (<200Hz)

### **Additional Metrics**
- Brightness (Spectral Centroid)
- Spectral Flux
- Energy Variation (RMS Std Dev)

## **Key Display**
- Musical keys shown as text labels (C, F#, Bb, etc.)
- Color-coded by mode:
  - ðŸŸ¢ **Green** = Major
  - ðŸ”´ **Red** = Minor
- Solves the circular key problem (keys don't map linearly)

---

# ðŸ—‚ï¸ TODO / Optional Extensions

### **1. Camelot Key Mapping**  
Convert keys (e.g., F# minor â†’ 11A) for harmonic mixing.

### **2. DJ Energy Index (combined metric)**  
Composite index using:
- percussive_ratio  
- onset_rate  
- hf_ratio  
- attack_sharpness  

### **3. Transition Compatibility Scoring**  
Quantify how two tracks blend based on:
- key distance  
- rhythmic density match  
- spectral balance similarity

### **4. Advanced Visualization**  
- 2D scatter plots (brightness vs. bass ratio)
- Energy flow timeline across playlist
- Clustering analysis based on audio features
- Heatmaps showing feature correlations

### **5. Spotify Audio Feature Fallback**  
If a track exists on Spotify:
- fetch MLâ€‘derived features (danceability, valenceâ€¦)  
- merge with local DSP metrics  
(No Spotify Premium required for these endpoints.)

---

# ðŸ§ª Notes on Audio Processing

- All audio is decoded on-the-fly (MP3, M4A/ALAC, FLAC, WAV, AAC).  
- Sampling rate is automatically resampled to 44.1 kHz.  
- Bit depth does not matter (16/24/32 float â†’ normalized internally).  
- Stereo mix â†’ mono for stable analysis.

---

# ðŸš€ Quick Start

## **Folder-Based Workflow**
```bash
# 1. Put audio files in music/ folder
# 2. Run analysis
python analyse_music.py

# 3. Visualize results
python plot_analysis.py
```

## **Playlist-Based Workflow**
```bash
# 1. Export playlist CSV with file paths
# 2. Run analysis (interactive)
python analyse_from_playlist.py
# â†’ Select CSV file
# â†’ Enter track range (e.g., 11-20)

# 3. Visualize results (interactive)
python plot_from_playlist.py
# â†’ Select analysis CSV to visualize
```

---

# âœ” Summary

This project extracts **real, deterministic, DSP-based audio descriptors** that directly correlate with DJâ€‘perceived musical properties:
- **Tonal center** (key/mode) with color-coded visualization
- **Rhythmic density** (onset rate) and **transient sharpness** (attack profile)
- **Energy profile** (RMS + percussive ratio)
- **Spectral balance** (HF vs bass content)
- **Timbral characteristics** (brightness, spectral flux)

## **Key Advantages**
âœ… **No Spotify Premium required**  
âœ… **Works offline** â€“ pure local DSP  
âœ… **Deterministic** â€“ no ML black boxes  
âœ… **DJ-focused** â€“ features that matter for mixing  
âœ… **Playlist-aware** â€“ analyze sets in sequence  
âœ… **Visual feedback** â€“ instant overview of track characteristics

These form a robust baseline for:
- Energy flow analysis across DJ sets
- Transition compatibility scoring
- Harmonic mixing planning
- Track selection and sequencing
- Integration with Spotify data if desired

